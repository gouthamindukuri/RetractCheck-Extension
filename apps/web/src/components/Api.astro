---
const endpoints = [
  {
    method: 'GET',
    path: '/v1/status',
    description: 'Check if a DOI has any retraction notices.',
    command: 'curl "https://api.retractcheck.org/v1/status?doi=10.1016/s0140-6736(97)11096-0"',
    response: `{
  "doi": "10.1016/s0140-6736(97)11096-0",
  "meta": {
    "updatedAt": "2026-01-24T02:01:31.170Z"
  },
  "records": [
    {
      "recordId": 280,
      "raw": {
        "Title": "Ileal-lymphoid-nodular hyperplasia...",
        "RetractionNature": "Retraction",
        "Reason": "Concerns/Issues About Data",
        "RetractionDate": "2010-02-02"
      }
    }
  ]
}`
  },
  {
    method: 'GET',
    path: '/v1/info',
    description: 'Database freshness and record count.',
    command: 'curl "https://api.retractcheck.org/v1/info"',
    response: `{
  "ok": true,
  "stale": false,
  "dataAgeHours": 2.5,
  "rowCount": 68353,
  "updatedAt": "2026-01-24T02:01:31.170Z"
}`
  },
  {
    method: 'GET',
    path: '/v1/health',
    description: 'Health check endpoint for monitoring.',
    command: 'curl "https://api.retractcheck.org/v1/health"',
    response: `{
  "ok": true
}`
  }
];
---

<section id="api" class="space-y-8">
  <div class="space-y-4">
    <h2 class="text-lg font-semibold">API</h2>
    <p class="text-text-muted text-sm leading-relaxed">
      Free REST API to check retraction status. No authentication required.
    </p>
    <div class="text-sm text-text-muted">
      Base URL: <code class="text-text bg-bg-code px-1.5 py-0.5 border border-border">https://api.retractcheck.org</code>
    </div>
  </div>

  <!-- Endpoints -->
  {endpoints.map((endpoint, index) => (
    <div class:list={["space-y-3 pb-8", index < endpoints.length - 1 && "border-b border-border"]}>
      <div class="flex items-center gap-3">
        <span class="px-2 py-0.5 text-xs font-medium bg-green-500/10 text-green-500 border border-green-500/20">
          {endpoint.method}
        </span>
        <code class="text-sm">{endpoint.path}</code>
      </div>

      <p class="text-sm text-text-muted">
        {endpoint.description}
      </p>

      <!-- Command -->
      <div class="space-y-1">
        <span class="text-xs text-text-muted">Command</span>
        <div class="relative group">
          <div class="bg-bg-code border border-border p-4 pr-12 overflow-x-auto">
            <pre class="text-sm"><code><span class="text-text-muted select-none">$ </span><span id={`cmd-${index}`}>{endpoint.command}</span></code></pre>
          </div>
          <button
            data-copy={endpoint.command}
            class="copy-btn absolute top-2 right-2 p-2 text-text-muted hover:text-text hover:bg-border/50 transition-colors opacity-0 group-hover:opacity-100"
            aria-label="Copy command to clipboard"
          >
            <svg class="w-4 h-4 copy-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
            <svg class="w-4 h-4 check-icon hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Response -->
      <div class="space-y-1">
        <span class="text-xs text-text-muted">Response</span>
        <div class="bg-bg-code border border-border p-4 overflow-x-auto">
          <pre class="text-sm"><code>{endpoint.response}</code></pre>
        </div>
      </div>
    </div>
  ))}

  <!-- Rate Limits & Cache -->
  <div class="space-y-3 pt-4 border-t border-border">
    <h3 class="text-sm font-medium">Rate Limits & Cache</h3>
    <table class="text-sm border border-border">
      <tr class="border-b border-border">
        <td class="px-3 py-2 text-text-muted border-r border-border">Extension users</td>
        <td class="px-3 py-2">50 req/min</td>
      </tr>
      <tr class="border-b border-border">
        <td class="px-3 py-2 text-text-muted border-r border-border">Anonymous</td>
        <td class="px-3 py-2">10 req/min</td>
      </tr>
      <tr>
        <td class="px-3 py-2 text-text-muted border-r border-border">Cache TTL</td>
        <td class="px-3 py-2">12 hours</td>
      </tr>
    </table>
  </div>
</section>

<script>
  document.querySelectorAll('.copy-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
      const command = btn.getAttribute('data-copy');
      if (!command) return;

      try {
        await navigator.clipboard.writeText(command);

        const copyIcon = btn.querySelector('.copy-icon');
        const checkIcon = btn.querySelector('.check-icon');

        if (copyIcon && checkIcon) {
          copyIcon.classList.add('hidden');
          checkIcon.classList.remove('hidden');

          setTimeout(() => {
            copyIcon.classList.remove('hidden');
            checkIcon.classList.add('hidden');
          }, 2000);
        }
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    });
  });
</script>
